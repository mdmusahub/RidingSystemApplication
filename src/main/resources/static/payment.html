<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Ride Payment</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f6f8fa;
        }
        .container {
            width: 450px;
            margin: 60px auto;
            padding: 30px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            color: #222;
            margin-bottom: 20px;
        }
        label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        button {
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            border: none;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background: #1a73e8;
            border-radius: 10px;
            cursor: pointer;
        }
        button:hover {
            background: #155fc3;
        }
    </style>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>

<div class="container">
    <h2>Ride Payment</h2>

    <label>Ride ID</label>
    <input type="text" id="rideId" th:value="${rideId}" readonly>

    <label>Amount (INR)</label>
    <input type="text" id="amount" th:value="${amount}" readonly>

    <label>Payment Method</label>
    <select id="paymentMethod">
        <option value="ONLINE">Online</option>
        <option value="CASH">Cash</option>
    </select>

    <button onclick="startPayment()">Pay Now</button>
</div>


<script th:inline="javascript">
    const razorpayKey = [[${razorpayKey}]];

    async function startPayment() {

        const rideId = document.getElementById("rideId").value;
        const amount = document.getElementById("amount").value;
        const paymentMethod = document.getElementById("paymentMethod").value;

        const payload = {
            rideId: Number(rideId),
            amount: Number(amount),
            paymentMethod: paymentMethod
        };

        // CASH PAYMENT HANDLING
        if (paymentMethod === "CASH") {
            alert("Cash Payment Recorded Successfully");
            window.location.href = "/";
            return;
        }

        // ONLINE PAYMENT â†’ Create Order
        const res = await fetch("/api/payment/create", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const order = await res.json();

        var options = {
            "key": razorpayKey,
            "amount": order.amount,
            "currency": "INR",
            "name": "Ride Booking",
            "description": "Ride Fare Payment",
            "order_id": order.id,
            "handler": function (response) {

                window.location.href =
                        "/payment/success?paymentId=" + response.razorpay_payment_id +
                        "&orderId=" + response.razorpay_order_id +
                        "&signature=" + response.razorpay_signature;
            }
        };

        var rzp = new Razorpay(options);
        rzp.open();
    }
</script>

</body>
</html>